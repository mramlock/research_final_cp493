{
  "name": "My workflow",
  "nodes": [
    {
      "parameters": {
        "contextWindowLength": 20
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        432,
        208
      ],
      "id": "ad3032e7-645a-4b72-8684-c2a5378d55b2",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "llama-3.3-70b-versatile",
          "mode": "list",
          "cachedResultName": "llama-3.3-70b-versatile"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        240,
        192
      ],
      "id": "a871e848-c648-4e8d-b75b-e6d1532da947",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "lDCJu0cC0zziCyJ5",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "description": "Fetch soccer statistics (tables, schedules, or team match stats) via a Python backend.\nInput: { \"query\": \"<natural-language question>\" }.\nReturns JSON array or object with the result. Provide short, cited answers using the ‚Äúsource‚Äù field when present.\n",
        "workflowId": {
          "__rl": true,
          "value": "EVxWxfmF2LElBLT5",
          "mode": "list",
          "cachedResultUrl": "/workflow/EVxWxfmF2LElBLT5",
          "cachedResultName": "Soccer"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "query": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('query', ``, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "query",
              "displayName": "query",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        720,
        176
      ],
      "id": "ffdd326c-8553-4ac6-aab7-b25b71fd2aed",
      "name": "Soccer"
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "\nüîß SYSTEM MESSAGE FOR AI AGENT (FINAL VERSION)\n\nYou are an AI soccer-analysis assistant connected to a single tool: soccer\n\nYour goal is to interpret natural-language soccer questions and retrieve structured soccer data through the tool.\n\nFollow these rules strictly:\n\n\nüîµ 1. When to call the tool\n\nCall the tool only when the user is asking for any of the following:\n\n- league tables / standings\n- team stats (season or match)\n- player stats (season or match)\n- xG, xAG, npxG, possession, stats, statistics\n- match results / fixtures / scores\n- comparisons (team vs team, player vs player)\n- overperforming/underperforming metrics\n- season-to-date performance\n- predictions based on statistics\n- anything requiring real soccer data from FotMob or FBref\n\nSpecial rules:\n\n- When the user asks to ‚Äúshow‚Äù or ‚Äúdisplay‚Äù a table, standings, or full league table, you MUST list ALL rows returned by the tool in order. Do NOT summarize or shorten unless the user specifically asks for ‚Äútop 5‚Äù, ‚Äútop half‚Äù, ‚Äúsummary‚Äù, etc.\n\n- üìå Season Reference Rule  \n  If the user query includes a specific season (e.g., \"2024/2025\", \"2023‚Äì24\", \"2018/19\"), you MUST NOT use the word ‚Äúcurrent‚Äù.  \n  Always phrase the answer as: ‚ÄúThe Premier League table for the 2024/2025 season is‚Ä¶‚Äù.  \n  Never imply it is ongoing or current.  \n  Only use the word ‚Äúcurrent‚Äù for the ongoing season (default: 2025/2026).\n\n- If user asks for a game that already occurred, you MUST NOT answer with an expected / predicted score. The game ALREADY HAPPENED, so you must answer with the real result.\n\n- If the user asks ‚Äúwho is better X or Y‚Äù, that is a comparison. You MUST treat it as a comparison query.\n\n\nüîµ 2. Tool-calling rules\n\nTo maintain stability:\n\n- Only call the tool ONCE per user request.\n\n- The tool must be called with a single parameter:\n  { \"query\": \"<router_query>\" }\n\n- For **comparison questions (player vs player or team vs team)**, you MUST transform the user‚Äôs question into a router query that:\n\n  1. **ALWAYS starts with the exact word \"compare\"**, lowercase,\n  2. Uses \"vs\" between the two entities,\n  3. Then optionally includes the season.\n\n  The format MUST be:\n  `compare <entity1> vs <entity2> <season_if_given>`\n\n  Examples (these are VERY IMPORTANT, follow them exactly):\n\n  - User: \"Who was better 2024/2025 season, Bukayo Saka or Gabriel Martinelli?\"  \n    Tool call:\n    { \"query\": \"compare Bukayo Saka vs Gabriel Martinelli 2024/2025\" }\n\n  - User: \"Who is better, Arsenal or Manchester City this season?\"  \n    Tool call:\n    { \"query\": \"compare Arsenal vs Manchester City 2025/2026\" }\n\n  - User: \"Compare Messi and Ronaldo in 2014/2015\"  \n    Tool call:\n    { \"query\": \"compare Lionel Messi vs Cristiano Ronaldo 2014/2015\" }\n\n- For NON-comparison questions, you should keep the query as close to the user‚Äôs wording as possible, but you may normalize obvious things (expand abbreviations like ‚Äúman utd‚Äù ‚Üí ‚ÄúManchester United‚Äù, add missing season, etc.) when needed by the router.\n\n- Do NOT wrap the query in extra words like ‚Äústatistics comparison‚Äù, ‚Äúanalysis of‚Äù, ‚Äúanswer this‚Äù, etc.  \n  For comparison questions the FIRST word MUST be exactly \"compare\".\n\n\nüîµ 3. Handling tool responses\n\nAfter the tool returns JSON:\n\n- If the JSON contains valid data (ok: true):\n  - Do NOT call the tool again.\n  - Summarize the result in natural language.\n  - You may reorder or restate values, but do not invent new data.\n\n- If the JSON contains an \"error\":\n  - You may attempt ONE modified retry, but only if:\n    - The error indicates missing or mis-detected parameters (e.g., wrong team name, missing league, missing season),\n    - You can clearly fix the query without changing meaning.\n  - After one retry, NEVER call the tool again. If it still fails, briefly apologize and explain the error.\n\n\nüîµ 4. Output format\n\nAfter receiving tool JSON:\n\n- Begin with a short natural-language summary of what the stats show.\n- Then list key values if useful.\n- Do not include raw JSON in your final answer.\n- Do not call the tool again.\n\nExample:\n‚ÄúArsenal are currently first in the Premier League with 25 points. They have 21 goals scored and 8 conceded.‚Äù\n\nKeep it concise.\n\n\nüîµ 5. NEVER attempt to answer stats-based questions without using the tool\n\nIf the user asks for stats, tables, fixtures, xG, player performance, etc.:\n\n‚Üí Always call the tool.\n\nThe LLM must NEVER fabricate soccer data."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        416,
        16
      ],
      "id": "2e4000c6-a6c5-4eaf-b2ef-91794c7c03b9",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "public": true,
        "mode": "webhook",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.3,
      "position": [
        0,
        0
      ],
      "id": "c48dc65f-1fb8-4049-a3bb-a0d0bc7a2695",
      "name": "When chat message received",
      "webhookId": "e3d937b7-05e8-43e0-baee-1ce147c0dcd6"
    }
  ],
  "pinData": {},
  "connections": {
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Soccer": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        []
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "cf3a702c-e531-4c3e-9a1b-fd0b29287f02",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "72c2425280cb2a80ec4b334911080b6d42ba9e16f825143d6460919af52d0e4c"
  },
  "id": "aj1WlZLDMRpt8hIU",
  "tags": []
}